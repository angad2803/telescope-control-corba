# CORBA Alarm System

A complete distributed alarm system built with CORBA (Common Object Request Broker Architecture) middleware, featuring ALMA-compliant interface definitions and REST API integration.

## 🏗️ Architecture Overview

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           CORBA ALARM SYSTEM FLOW                              │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    HTTP REST     ┌─────────────────┐    Java Process    ┌─────────────┐
│   POSTMAN   │ ─────────────────→│  EXPRESS.JS     │ ─────────────────→ │ CORBA CLIENT│
│   Client    │                  │  REST BRIDGE    │                    │  (Java)     │
└─────────────┘                  │  (Node.js)      │                    └─────────────┘
                                 │  Port: 3000     │                           │
                                 └─────────────────┘                           │
                                                                               │
                                                                      CORBA Protocol
                                                                     (Object Request)
                                                                               │
                                                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              CORBA SERVER LAYER                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    IOR Ref     ┌─────────────────┐    Method Call   ┌─────────┐ │
│  │    ORB      │ ──────────────→│   AlarmImpl     │ ───────────────→ │Business │ │
│  │ (Object     │                │ (CORBA Servant) │                  │ Logic   │ │
│  │ Request     │                │                 │                  │         │ │
│  │ Broker)     │                │ - getAlarmById()│                  │         │ │
│  └─────────────┘                │ - getAction()   │                  │         │ │
│                                 │ - getPriority() │                  │         │ │
│                                 └─────────────────┘                  └─────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 📁 Project Structure

```
alarmsystem-project/
├── idl/alarmsystem/
│   └── Alarm.idl                    # IDL Interface Definition (ALMA-compliant)
│
├── corba-server/
│   ├── pom.xml                      # Maven build configuration
│   └── src/main/java/alarmsystem/
│       ├── AlarmImpl.java           # CORBA Servant Implementation
│       ├── Server.java              # CORBA Server Launcher
│       ├── CorbaClient.java         # CORBA Client Test Tool
│       ├── AlarmHelper.java         # Generated by idlj compiler
│       ├── AlarmPOA.java            # Generated by idlj compiler
│       └── Alarm.java               # Generated by idlj compiler
│
└── express-bridge/
    ├── package.json                 # Node.js dependencies
    └── server.js                    # REST API Bridge
```

## 🚀 Quick Start

### Prerequisites

- **Java 8 JDK** (for CORBA support with idlj compiler)
- **Maven 3.x** (for Java build management)
- **Node.js 16+** (for Express.js REST bridge)

### 1. Compile IDL to Java Stubs

```powershell
cd corba-server
idlj -fall -td src/main/java ../idl/alarmsystem/Alarm.idl
```

### 2. Build CORBA Server

```powershell
mvn clean compile
```

### 3. Start CORBA Server

```powershell
java -cp "target/classes" alarmsystem.Server
```

**Expected Output:**

```
Starting CORBA Alarm Server...
Alarm CORBA server is running...
IOR written to Alarm.ref
Server ready to accept requests
Press Ctrl+C to stop the server
Server entering main loop...
```

### 4. Start Express.js REST Bridge

```powershell
cd ../express-bridge
npm install
npm start
```

**Expected Output:**

```
Express Alarm Bridge running on port 3000
Alarm endpoint: http://localhost:3000/alarm
```

## 🎯 API Endpoints

### Health Check

- **URL**: `http://localhost:3000/health`
- **Method**: `GET`
- **Response**:

```json
{
  "status": "OK",
  "service": "Alarm Express Bridge"
}
```

### Get Alarm Data (Default)

- **URL**: `http://localhost:3000/alarm`
- **Method**: `GET`
- **Response**:

```json
{
  "id": "ALM001",
  "description": "CORBA-ALARM-ALM001",
  "action": "Check system status",
  "priority": 5,
  "status": "ACTIVE",
  "timestamp": "2025-09-18T06:09:29.319Z",
  "source": "CORBA-Server"
}
```

### Get Alarm by Specific ID

- **URL**: `http://localhost:3000/alarm/{id}`
- **Method**: `GET`
- **Example**: `http://localhost:3000/alarm/ALM002`
- **Response**:

```json
{
  "id": "ALM002",
  "description": "CORBA-ALARM-ALM002",
  "source": "CORBA-Server",
  "method": "getAlarmById",
  "timestamp": "2025-09-18T06:09:29.319Z"
}
```

### Get Alarm Action

- **URL**: `http://localhost:3000/alarm/action`
- **Method**: `GET`
- **Response**:

```json
{
  "action": "Execute emergency procedure",
  "source": "CORBA-Server",
  "method": "getAction",
  "timestamp": "2025-09-18T06:09:29.319Z"
}
```

### Get Alarm Priority

- **URL**: `http://localhost:3000/alarm/priority`
- **Method**: `GET`
- **Response**:

```json
{
  "priority": 5,
  "source": "CORBA-Server",
  "method": "getPriority",
  "timestamp": "2025-09-18T06:09:29.319Z"
}
```

## 🧪 Testing

### Direct CORBA Client Testing

```powershell
cd corba-server

# Test getAlarmById method
java -cp "target/classes" alarmsystem.CorbaClient getAlarmById ALM001

# Test getAction method
java -cp "target/classes" alarmsystem.CorbaClient getAction

# Test getPriority method
java -cp "target/classes" alarmsystem.CorbaClient getPriority

# Test with different alarm IDs
java -cp "target/classes" alarmsystem.CorbaClient getAlarmById CRITICAL001
```

### Postman Testing

1. Import the provided endpoints
2. Test each endpoint individually
3. Verify CORBA responses in real-time
4. Monitor CORBA server console for incoming requests

## 🔄 Request Flow Diagram

```
                              DETAILED REQUEST FLOW

1. ┌─────────────┐  GET /alarm/ALM001
   │   POSTMAN   │ ─────────────────────────────────────────────────────────┐
   └─────────────┘                                                         │
                                                                           ▼
2. ┌─────────────────┐  req.params.id = "ALM001"
   │  EXPRESS.JS     │  callCorbaMethod("getAlarmById", "ALM001")
   │  server.js      │ ────────────────────────────────────────────────────┐
   └─────────────────┘                                                    │
                                                                          ▼
3. ┌─────────────────┐  spawn("java", ["-cp", "target/classes",
   │  CHILD PROCESS  │         "alarmsystem.CorbaClient",
   │  (Node.js)      │         "getAlarmById", "ALM001"])
   └─────────────────┘ ────────────────────────────────────────────────────┐
                                                                          ▼
4. ┌─────────────────┐  ORB.init() → string_to_object(IOR)
   │ CORBA CLIENT    │  → AlarmHelper.narrow(obj)
   │ CorbaClient.java│  → alarm.getAlarmById("ALM001")
   └─────────────────┘ ────────────────────────────────────────────────────┐
                                                                          ▼
5. ┌─────────────────┐  Reads Alarm.ref file (IOR reference)
   │   CORBA ORB     │  Locates AlarmImpl servant object
   │   (Runtime)     │  Marshalls method call
   └─────────────────┘ ────────────────────────────────────────────────────┐
                                                                          ▼
6. ┌─────────────────┐  public String getAlarmById(String id) {
   │   AlarmImpl     │    return "CORBA-ALARM-" + id;
   │   (Servant)     │  }
   └─────────────────┘ ────────────────────────────────────────────────────┐
                                                                          │
                               RESPONSE FLOW                              │
                                                                          ▼
7. ┌─────────────────┐  Returns: "CORBA-ALARM-ALM001"
   │   AlarmImpl     │  ◄───────────────────────────────────────────────────┘
   └─────────────────┘
           │
           ▼
8. ┌─────────────────┐  System.out.println("CORBA-ALARM-ALM001");
   │ CORBA CLIENT    │
   └─────────────────┘
           │
           ▼ stdout
9. ┌─────────────────┐  javaProcess.stdout.on('data', callback)
   │  EXPRESS.JS     │  output = "CORBA-ALARM-ALM001"
   └─────────────────┘
           │
           ▼
10.┌─────────────────┐  res.json({
   │  EXPRESS.JS     │    "id": "ALM001",
   │  Response       │    "description": "CORBA-ALARM-ALM001",
   └─────────────────┘    "source": "CORBA-Server", ... })
           │
           ▼ HTTP Response
11.┌─────────────────┐  {
   │   POSTMAN       │    "id": "ALM001",
   │   Result        │    "description": "CORBA-ALARM-ALM001",
   └─────────────────┘    "timestamp": "2025-09-18T06:09:29.319Z" }
```

## 🔧 Key Components

### 1. IDL Interface (ALMA-Compliant)

```idl
module alarmsystem {
    interface Alarm {
        string getAlarmById(in string id);
        string getAction();
        long getPriority();
    };
};
```

### 2. CORBA Servant Implementation

- **AlarmImpl.java** - Extends AlarmPOA, implements business logic
- **Server.java** - Initializes ORB, activates POA, publishes IOR
- **CorbaClient.java** - Test client for direct CORBA method calls

### 3. Express.js REST Bridge

- **server.js** - Translates HTTP requests to CORBA calls via Java subprocess
- Spawns Java processes to call CORBA methods
- Formats CORBA responses as JSON for REST consumption

### 4. Build System

- **Maven** for Java compilation and dependency management
- **npm** for Node.js package management
- **idlj compiler** for IDL-to-Java stub generation

## 🎯 ALMA Standards Compliance

This system implements **ALMA (Atacama Large Millimeter Array)** compatible interface definitions:

- ✅ **getAlarmById(in string id)** - Retrieve alarm by identifier
- ✅ **getAction()** - Get alarm action description
- ✅ **getPriority()** - Get alarm priority level
- ✅ **Enterprise-grade CORBA middleware** for distributed computing
- ✅ **Interoperable Object References (IOR)** for service discovery

## 🚨 Troubleshooting

### CORBA Server Won't Start

- Ensure Java 8 JDK is installed and configured
- Check that port is not in use by another process
- Verify `target/classes` directory contains compiled Java files

### Express Bridge Connection Errors

- Confirm CORBA server is running and has created `Alarm.ref` file
- Check that Java classpath is correctly set in Express server
- Verify CORBA server working directory matches Express configuration

### IDL Compilation Issues

- Ensure `idlj` compiler is available (part of Java 8 JDK)
- Check IDL syntax matches CORBA specification
- Verify output directory structure is correct

## 📦 Dependencies

### Java (corba-server)

- Java 8 JDK (includes CORBA and idlj compiler)
- Maven 3.x
- Generated CORBA stubs (AlarmHelper, AlarmPOA, etc.)

### Node.js (express-bridge)

- Express.js 4.18.2
- CORS middleware
- Child process spawning for Java integration

## 🎉 Features

- ✅ **True Distributed Computing** - CORBA middleware for enterprise-grade RPC
- ✅ **ALMA Standards** - Compatible with astronomical observatory systems
- ✅ **REST API Integration** - Modern HTTP endpoints calling legacy CORBA services
- ✅ **Real-time Processing** - Live CORBA method invocation via REST
- ✅ **Multi-language Support** - Java CORBA server with Node.js REST bridge
- ✅ **Enterprise Architecture** - POA activation, IOR publishing, ORB lifecycle management

## 📝 License

This project demonstrates CORBA distributed computing concepts and ALMA-compliant interface definitions for educational and enterprise integration purposes.

---

**Built with enterprise-grade CORBA middleware for true distributed alarm processing** 🚀
